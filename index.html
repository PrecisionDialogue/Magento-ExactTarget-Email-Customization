<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
	<script src="javascripts/jquery-1.11.0.min.js"></script>
	<script src="javascripts/lightbox.min.js"></script>
	<link href="stylesheets/lightbox.css" rel="stylesheet" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Magento ExactTarget Email Customization by PrecisionDialogue</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Magento ExactTarget Email Customization</h1>
          <h2>Details for configuring and customizing emails for the PrecisionDialogue ExactTarget Magento module</h2>
        </header>

        <hr>

        <section id="main_content">
          <h3><a name="welcome" class="anchor" href="#welcome"><span class="octicon octicon-link"></span></a>Welcome the user documentation for customizing email templates in the <a href="http://ecommerce.precisiondialogue.com/services/magento-exacttarget-integration/">Magento ExactTarget Integration</a> module.</h3>

			<p>These pages will detail the steps required to customize email content for transactional emails initiated in Magento and sent via ExactTarget. Due to the structure of the solution there are multiple &quot;templates&quot; and thus there are multiple locations where templates can be modified, depending on the particular modification requirements.</p>

			<h3><a name="toc" class="anchor" href="#toc"><span class="octicon octicon-link"></span></a>Table Of Contents</h3>
			<ol>
				<li><a href="#overview">System Overview</a></li>
				<li><a href="#magento-options">Magento Configuration</a></li>
				<li><a href="#et-options">ExactTarget Configuration</a></li>
				<li><a href="#walkthrough">Walkthrough</a></li>
			</ol>
        </section>

		<section id="overview">
			<h3><a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>System Overview</h3>
			<p>The Magento ExactTarget integration enables the fulfilment of transactional emails by ExactTarget triggered by events in Magento. Because there are multiple components involved in the fulfilment process there are two places where different templates can be modified to change both the appearance and functionality of the emails.</p>
			<p>The email fulfilment process consists of two portions, the first is the initiation of an email send in the Magento system. This functionality uses the existing Magento email templating functionality and is required.</p>
			<p>An email send event is triggered in Magento where the Precision Dialogue ExactTarget extension checks to see if the email is configured to be fulfilled by ExactTarget. Emails initiated in Magento are not automatically configured to be sent with ExactTarget, they must be explicitly configured to be sent from the Magento <em>ExactTarget -> Configuration -> Email</em> screen (see <a href="#magento-options">Magento Configuration</a> for configuration details). Regardless of configuration, Magento rendering logic is always invoked to render the email template to it's final HTML representation.</p>
			<p>If the email is not configured to be sent via ExactTarget, the subject and rendered HTML content are passed back to Magento Core for sending via the configured system mail sending option.</p>
			<p>If the email is configured to be sent via ExactTarget, then the subject and rendered HTML content are sent to ExactTarget for insertion into an existing email definition. The subject text is used as the subject of the email and the HTML is inserted into the location where the content personalization string (<strong>magento_email_content</strong>) is located. See the <a href="#et-options">ExactTarget Configuration</a> for details.</p>
			<p><a href="images/MagentoETEmailProcess.png" data-lightbox="ProcessDiagram" data-title="Process Diagram"/><img src="images/MagentoETEmailProcess.png" alt="Process Diagram" /></a></p>
        </section>

		<section id="magento">
			<h3><a name="magento-options" class="anchor" href="#magento-options"><span class="octicon octicon-link"></span></a>Magento Configuration</h3>

			<p>Magento configuration starts with the editing of the Magento email template that will be used as the base of the email. If changes to the template are required you can either edit the <a href="http://www.magento.cc/how-to-change-the-magento-email-templates.html" target="_blank">base template file</a> for the email that is stored on the Magento file system, or you can create a new <a href="http://go.magento.com/support/kb/entry/name/customizing-transactional-emails" target="_blank">custom email template</a> from the <em>System -> Transactional Emails</em> screen.</p>
			
			
			<p><h4>In this walkthrough we are creating a customized email template based on the <em>New Account</em> email for a specific store.</h4></p>
			
			<p>First, we create the new transactional email template from the New Account template, give the template a unique name, and edit the subject and content. Any <a href="http://www.magentocommerce.com/wiki/modules_reference/english/mage_adminhtml/system_email_template/index" target="_blank">Magento specific template variables</a> must be contained in this email template, as it is the only one that is processed with Magento.<p>
			<p><a href="images/magento-email-template.png" data-lightbox="magento-email-template" data-title="Magento Email Template"><img src="images/magento-email-template.png" alt="Magento Email Template" /></a></p>
			<p>Next, we configure the ExactTarget extension to use ExactTarget as the email sender for our store's <em>New Account</em> email. In Magento we navigate to the <em>ExactTarget -> Configuration -> Email</em> screen and add a new email configuration for our store/email configuration.</p>
			<p><a href="images/magento-email-et-config-detail.png" data-lightbox="magento-email-et-config-detail" data-title="Email Configuration"><img src="images/magento-email-et-config-detail.png" alt="Email Configuration" /></a></p>
			<p>In the configuration we set the <em>Email template code</em> to the correct value of the base email template we want to be sent through ExactTarget. For our example we are going to select the <strong>New account</strong> template. 
			<p>Since this is going to be a store specific email we next set the <em>Scope</em> setting to our specific store level scope. To use the same email template for all sites or stores we would set the <em>Scope</em> value to the relevant scope.</p>
			<p>Next, we give our email configuration a unique CustomerKey value. This needs to be unique within the configured ExactTarget account (or within the configured ExactTarget Business Unit if using an ExactTarget Enterprise 2.0 account). The Customer Key value is used to manage the ExactTarget side of the email interaction, see the <a href="#et-options">ExactTarget Configuration</a> section for more details.</p> 
			<p>If we are not going to use the default template we then need to set the <em>Custom Email Template</em> setting to the specific custom template we want to use. In our case, since we are configuring for a specific store, we will set the value to the custom transactional email template we created above (<strong>New Account Store 3</strong>).</p>
			<p>	Finally, we set the <em>Asynchronous</em> value. This will determine if the ExactTarget API calls to send the configured email are executed immediately during the email sending process or if they will be placed into a queue for later execution.</p>
			<p>With this we have now completed all that is necessary for the basic use case of configuring Magento to send emails via ExactTarget. We have also reviewed the process for customizing the templating from the Magento side.<p>
			<p>Remember that there are two places where email template customizations can be made: Magento and ExactTarget.</p>
			<p>Any <a href="http://www.magentocommerce.com/wiki/modules_reference/english/mage_adminhtml/system_email_template/index" target="_blank">Magento specific template variables</a> must be in the Magento hosted template for them to be properly processed during an email send. 
			<p>Any ExactTarget specific <a href="http://help.exacttarget.com/en-US/documentation/exacttarget/content/personalization_strings/" target="_blank">personalization strings</a> or <a href="http://help.exacttarget.com/en-US/documentation/exacttarget/content/ampscript/" target="_blank">AMPScript</a> declared in the Magento template will not be evaluated or executed as they will be passed as string literals in the HTML body. See the <a href="#et-options">ExactTarget Configuration</a> section for details on ExactTarget specific options.</p>
		</section>

		<section id="exact-target">
			<h3><a name="et-options" class="anchor" href="#et-options"><span class="octicon octicon-link"></span></a>ExactTarget Configuration</h3>
			<p>To support the sending of transactional emails using ExactTarget the Precision Dialogue ExactTarget Magento integration creates and uses a number of triggered send email objects within ExactTarget. When a Magento transactional email is configured to be sent with ExactTarget the extension will either create or reuse (depending on the customer key setting) an email definition, a transactional data extension and a triggered send interaction definition.</p>
			<p>The triggered send interaction will be configured to send the specific email definition and to use the transactional data extension for storing data. For the email subject it will use the <strong>magento_email_subject</strong> personalization string value that is passed from Magento in the API call. This will contain the value of the email template subject as populated by Magento during the email send event. </p> 
			<p><a href="images/et-triggered-send-interaction.png" data-lightbox="et-triggered-send-interaction" data-title="Triggered Send Interaction"><img src="images/et-triggered-send-interaction.png" alt="Triggered Send Interaction" /></a></p>
			<p>The transactional data extension is keyed to the configured customer key and stores the details of the sent emails, including the recipient email address, the optional subscriber key (populated with the value of the email address), the value of the subject (<strong>magento_email_subject</strong>) and the entire HTML text of the email body (<strong>magento_email_content</strong> as rendered by Magento.</p>
			<p><a href="images/et-data-extension.png" data-lightbox="et-data-extension" data-title="Data Extension"><img src="images/et-data-extension.png" alt="Data Extension" /></a></p>
			<p>When the email definition is created, the subject is set to be the <strong>magento_email_subject</strong> value passed from Magento and the entire body is the <strong>magento_email_content</strong> value that is the HTML text of the email template as rendered by Magento.
			<p><a href="images/et-email-props.png" data-lightbox="et-email-props" data-title="Email Properties"><img src="images/et-email-props.png" alt="Email Properties" /></a></p>
			<p><a href="images/et-email-details-default.png" data-lightbox="et-email-details-default" data-title="Default Email Details"><img src="images/et-email-details-default.png" alt="Default Email Details" /></a></p>
			<h4><a name="et-customization" class="anchor" href="#et-customization"><span class="octicon octicon-link"></span></a>Customizing With ExactTarget specific functionality</h4>
			<p>The email can be further customized with ExactTarget specific functionality such as additional personalization strings, profile center text, CAN-SPAM mailing address text, <a href="http://help.exacttarget.com/en-US/documentation/exacttarget/content/ampscript/" target="_blank">AMPScript</a> (including using content areas for easier boilerplate templating) and additional text by editing the email defintion after the Magento extension creates the initial object.</p>
			<p>To ensure that we edit the correct ExactTarget email definition we ensure that we edit the email definition that is configured in the <em>New Account</em> triggered send defintion. In our example we will edit the <em>New Account</em> email in our <em>Store 3</em> ExactTarget Business Unit and add text to display the sender address details (as required by CAN-SPAM), a link to our ExactTarget preference center and some AMPScript to display a unique value within the email.<p>
			<p><a href="images/et-email-details-custom.png" data-lightbox="et-email-details-custom" data-title="Customized Email Details"><img src="images/et-email-details-custom.png" alt="Custom Email Details" /></a></p>
			<p>Once we finish editing the ExactTarget email definition we need to ensure that the updated template will be used by ExactTarget. To do this we navigate to the appropriate Triggered Send Interaction (usually under the <em>Magento Triggered Sends</em> folder, select the triggered send interaction(s) that use that email definition and click <strong>Publish Changes</strong>. This will update the cached email definition that is used by the triggered send interaction and ensure that our modifications are used for all future sends of that email.</p>
			<p><a href="images/et-interaction-publish.png" data-lightbox="et-interaction-publish" data-title="Publish Triggered Send Interaction"><img src="images/et-interaction-publish.png" alt="Publish Triggered Send Interaction" /></a></p>
			<p>Remember that any <a href="http://www.magentocommerce.com/wiki/modules_reference/english/mage_adminhtml/system_email_template/index" target="_blank">Magento specific template variables</a> must be defined in the Magento template, placing them in the ExactTarget email definition will result in the variable defintions being rendered as string literals in the body of the email.</p>
		</section>
		<section id="walkthrough">
			<h3><a name="walkthrough" class="anchor" href="#walkthrough"><span class="octicon octicon-link"></span></a>Walkthrough</h3>
			<p>Now that all of our configuration is complete and we have customized both our Magento transactional email template and the ExactTarget email definition, we will walk through the experience of creating a new account and validating that all the correct templating functionality is executing.</p>
			<p>First, we navigate to our Magento store and create a new account.</p>
			<p><a href="images/magento-new-account.png" data-lightbox="magento-new-account" data-title="New Account"><img src="images/magento-new-account.png" alt="New Account" /></a></p>
			<p>We submit the request for a new account. Magento creates the account and since this store has a ExactTarget email configuration for the <em>New Account</em> email, Magento first renders the template as HTML then sends the subject and body to ExactTarget. Next, ExactTarget receives the content from Magento, renders it in the <strong>magento_email_content</strong> placeholder, adds the email sender and preference center text that is in the email definition and sends the final email to the subscriber.</p>
			<p>The final result is an email that contains templated text from Magento (highligted in red) and templated text from ExactTarget (highlighted in green).</p>
			<p><a href="images/et-email-final.png" data-lightbox="et-email-final" data-title="Email"><img src="images/et-email-final.png" alt="Email" /></a></p>
						
		</section>

        <footer>
          Magento-exacttarget-email-customization is maintained by <a href="https://github.com/PrecisionDialogue">PrecisionDialogue</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>